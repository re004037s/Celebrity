<div class="users-show--wrapper">
  
  <h2 class="page-title">
    <span>MY PAGE</span>
  </h2>

  <h3 class="center">
    <%= @user.name %>
  </h3>

  <div class="center">
    <% if @user.picture_file %>
    <%= image_tag(get_image_user_path, class: "picture_resize") %>
    <% else %>
    <%= image_tag('default.png') %>
    <% end %>
  </div>

  <div class="center mt_20">
    <!--<button class="edit-my-picture btn btn-default active">写真を編集する</button>-->
    
    <div id="upload-my-picture" class="mg_auto wh_30">
      <%= form_for(@user, url: post_pic_path, :id => 'form_id' ) do |f| %>
      <div class="form-group has-error">
        <span id="__has-warning" style="color: red;">画像を選択してください</span>
        <%= f.file_field :picture, accept: 'image/*' %>
        <%= f.hidden_field :id, :value => "#{@user.id}" %>
        <%= f.submit '画像をアップロード', id: 'fileuploader', class: 'btn btn-default active fileuploader', :disabled => 'true' %>
        <%= f.hidden_field :id, :value => "#{@user.id}" %>      
      </div>
      <% end %>
    </div>
  </div>

  
  <script type="text/javascript">
  
    
    $('#user_picture').bind('change', function() {
      
    var size_in_megabytes = this.files[0].size/1024/1024;
    
    // 画像未選択の場合
    if (size_in_megabytes === null){
      $("#fileuploader").prop("disabled", true);
      $('#__has-warning').show();
    }
    
    // 画像のサイズが5MBを超える場合
    if (size_in_megabytes > 5) {
      $('#__has-warning').text('5MB以下のファイルを選択してください。');
      $('#__has-warning').css('color','red');
      $('#__has-warning').show();
      $("#fileuploader").prop("disabled", true);
    
    // 画像のサイズが5MB以下の場合（正常）
     }else if (size_in_megabytes <= 5){
       $('#__has-warning').text('アップロードできます');
       $('#__has-warning').css('color','blue');
       $("#fileuploader").prop("disabled", false);
     }
     
    });
  </script>

<ul id="interest-tags"></ul>
<!--tag-it.jsに関する注意点-->
<!--TODO:application.jsで読み込み後、関数がundefiedになるためここで読み込む-->
<!--ネットワークコストがかかるため、パフォーマンス低下の原因となっている-->
<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1/jquery-ui.min.js"></script>
<script src="https://rawgit.com/aehlke/tag-it/master/js/tag-it.js"></script>
<script>
var suggestedInterests = [
  "C++", "JAVA", "PHP", "Javascript", "Ruby", "Python", "C", "RubyOnRails",
  "cobol", "vim", "emacs", "Scala", "C#", "HTML", "CSS", "VisualBasic.NET",
  "golang", "Swift", "Shell", "R",
  "Slack", "cloud9", "Qiita"
]
var tag_cnt = 0;

$('#interest-tags').tagit({
  
  placeholderText:"好きな言語やツールのタグを登録。最大10個",
  fieldName:"user[tag_list]",
  singleField: true,
  removeConfirmation: true,  //バックスペース1回押すとremoveClassが適用。対象タグに色がつく
  caseSensitive: false,      //大文字小文字を区別しない。
  tagLimit: 10,               //最大登録タグ数
  availableTags: suggestedInterests,
  
  afterTagAdded: function(event, ui) {
    // FUTURE FIX: onload時にインサートが実行されてしまうため一時回避策
    if(tag_cnt >= <%= @tags_count %>){
      ajax_insert_new_tag_to_DB(ui.tagLabel, <%= @user.id %>);
    }
    tag_cnt += 1;
  },
  onTagExists: function(event, ui) {
    var duplicated_tag_name = ui.existingTag[0].children[0].textContent;
  },
  onTagClicked: function(event, ui) {
  },
  onTagLimitExceeded: function(event, ui) {
  },
  afterTagRemoved: function(event, ui) {
    var tag_id = $(ui.tag[0]).find('input:hidden[name="tag_id"]').val();
    ajax_delete_tag_in_DB(tag_id, <%= @user.id %>);
  }

});

$('.tagit-new').css('width','100%');

function ajax_insert_new_tag_to_DB(tagLabel, user_id){
  // NOTE:rails のhelperを使用していないため CSRF用のTOKENをヘッダーに含める必要がある。
  $.ajaxPrefilter(function(options, originalOptions, jqXHR) {
    var token;
    if (!options.crossDomain) {
      token = $('meta[name="csrf-token"]').attr('content');
      if (token) {
           return jqXHR.setRequestHeader('X-CSRF-Token', token);
       }
    }
  });
  var param = 'tag_name=' + tagLabel + '&' + 'id=' + user_id;
    
  $.ajax({ 
    url: '/tag_new', 
    type: 'POST', 
    data: param, 
    dataType: 'json' 
  })
  
  .done(function(res){ 
    if(res === 200)console.log("saved");
    if(res === 500)alert("httpstatus 500: internal server errror");
  })
  
}

function ajax_delete_tag_in_DB(tag_id, user_id){
  $.ajaxPrefilter(function(options, originalOptions, jqXHR) {
    var token;
    if (!options.crossDomain) {
      token = $('meta[name="csrf-token"]').attr('content');
      if (token) {
           return jqXHR.setRequestHeader('X-CSRF-Token', token);
       }
    }
  });
  var param = 'tag_id=' + tag_id + '&' + 'id=' + user_id;

  $.ajax({
    url: '/tag_delete', 
    type: 'DELETE', 
    data: param, 
    dataType: 'json' 
  })
  
  .done(function(res){ 
    if(res === 200)console.log("deleted");
    if(res === 500)alert("httpstatus 500: internal server errror");
  })
  
}
</script>  

<!--登録済みタグの表示-->
<% @tags_h.each do |key, value| %>
<script>
  $("#interest-tags").tagit("createTag", "<%= key %>");
  $(".tagit-close").last().append('<input type="hidden" name="tag_id" value="'+ <%= value %> + '">');
</script>
<% end %>
  
  <table class="txt1 table-condensed table-status-schedule">
     <tr valign="baseline">
       <td width="80%">
        <h3 class="txt3">[Progate] HTML&CSS</h3>
        <td>
    </tr>
  </table>
  
   <!--進捗線を表示-->
  <progress id="html_css_progress" value="0" max="8"></progress>
  <output id="html_css_output"></output>

<script>
    let current_status1 = <%= count_html_css(@user) %>;
    let total_course_num1 = document.getElementById('html_css_progress').max;
    
    function countup() {
        document.getElementById('html_css_progress').value = current_status1;
        document.getElementById('html_css_output').value = '進捗率：' + (current_status1 / total_course_num1 * 100).toFixed() + '%';
    }

    setInterval(countup, 1000);
</script>

  <table class="txt1 table table-bordered table-striped table-condensed table-status">
    <thead>
      <tr>
        <th class="table-header">コース</th>
        <th class="table-header">状況</th>
        <th class="table-header">完了予定日</th>
        <th class="table-header">目安(日)</th>
        <th class="table-header">完了日</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>学習コース/初級</td>
        <td class="center"><%= @user.html_css_status.try(:ga_beginner) ? '完了' : '未' %></td>
        <td>
          <%= @user.html_css_status.try(:ga_beginner_completion) if @user.html_css_status.ga_beginner_completion.present? %><span class="font-schedule">
          <%= form_for(@user.html_css_status, url: html_css_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "html_css_ga_beginner"%>
          <% end %>
        </td>
        <td class="center">約1日</td>
        <td><%= @user.html_css_status.try(:ga_beginner_compd) %></td>
      </tr>
      <tr>
        <td>学習コース/中級</td>
        <td class="center"><%= @user.html_css_status.try(:ga_middle) ? '完了' : '未' %></td>
        <td>
          <%= @user.html_css_status.try(:ga_middle_completion) if @user.html_css_status.ga_middle_completion.present? %><span class="font-schedule">
          <%= form_for(@user.html_css_status, url: html_css_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "html_css_ga_middle"%>
          <% end %>
        </td>
        <td class="center">約1日</td>
        <td><%= @user.html_css_status.try(:ga_middle_compd) %></td>
      </tr>
      <tr>
        <td>学習コース/上級</td>
        <td class="center"><%= @user.html_css_status.try(:ga_advanced) ? '完了' : '未' %></td>
        <td>
          <%= @user.html_css_status.try(:ga_advanced_completion) if @user.html_css_status.ga_advanced_completion.present? %><span class="font-schedule">
          <%= form_for(@user.html_css_status, url: html_css_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "html_css_ga_advanced"%>
          <% end %>
        </td>
        <td class="center">約1日</td>
        <td><%= @user.html_css_status.try(:ga_advanced_compd) %></td>
      </tr>
      <tr>
        <td>道場コース/初級</td>
        <td class="center"><%= @user.html_css_status.try(:do_beginner) ? '完了' : '未' %></td>
        <td>
          <%= @user.html_css_status.try(:do_beginner_completion) if @user.html_css_status.do_beginner_completion.present? %><span class="font-schedule">
          <%= form_for(@user.html_css_status, url: html_css_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "html_css_do_beginner"%>
          <% end %>
        </td>
        <td class="center">約1日</td>
        <td><%= @user.html_css_status.try(:do_beginner_compd) %></td>
      </tr>
      <tr>
        <td>道場コース/中級</td>
        <td class="center"><%= @user.html_css_status.try(:do_middle) ? '完了' : '未' %></td>
        <td>
          <%= @user.html_css_status.try(:do_middle_completion) if @user.html_css_status.do_middle_completion.present? %><span class="font-schedule">
          <%= form_for(@user.html_css_status, url: html_css_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "html_css_do_middle"%>
          <% end %>
        </td>
        <td class="center">約1日</td>
        <td><%= @user.html_css_status.try(:do_middle_compd) %></td>
      </tr>
      <tr>
        <td>道場コース/上級</td>
        <td class="center"><%= @user.html_css_status.try(:do_advanced) ? '完了' : '未' %></td>
        <td>
          <%= @user.html_css_status.try(:do_advanced_completion) if @user.html_css_status.do_advanced_completion.present? %><span class="font-schedule">
          <%= form_for(@user.html_css_status, url: html_css_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "html_css_do_advanced"%>
          <% end %>
        </td>
        <td class="center">約1日</td>
        <td><%= @user.html_css_status.try(:do_advanced_compd) %></td>
      </tr>
    </tbody>
  </table>
  
  <table class="txt1 table-condensed table-status-schedule">
     <tr valign="baseline">
      <td width="60%">
        <h3 class="txt3">[Progate] JavaScript</h3>
      </td>
    </tr>
  </table>
  
  <!--進捗線を表示-->
  <progress id="javascript_progress" value="0" max="5"></progress>
  <output id="javascript_output"></output>

<script>
    let current_status2 = <%= count_javascript(@user) %>;
    let total_course_num2 = document.getElementById('javascript_progress').max;
    
    function countup() {
        document.getElementById('javascript_progress').value = current_status2;
        document.getElementById('javascript_output').value = '進捗率：' + (current_status2 / total_course_num2 * 100).toFixed() + '%';
    }

    setInterval(countup, 1000);
</script>

  <table class="txt1 table table-bordered table-striped table-condensed table-status">
    <thead>
      <tr>
        <th class="table-header">コース</th>
        <th class="table-header">状況</th>
        <th class="table-header">完了予定日</th>
        <th class="table-header">目安(日)</th>
        <th class="table-header">完了日</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>学習コース 1</td>
        <td class="center"><%= @user.javascript_status.try(:ga_1) ? '完了' : '未' %></td>
        <td>
          <%= @user.javascript_status.try(:ga_1_completion) if @user.javascript_status.ga_1_completion.present? %><span class="font-schedule">
          <%= form_for(@user.javascript_status, url: javascript_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "javascript_ga_1"%>
          <% end %>
        </td>
        <td class="center">約半日</td>
        <td><%= @user.javascript_status.try(:ga_1_compd)%></td>
      </tr>
      <tr>
        <td>学習コース 2</td>
        <td class="center"><%= @user.javascript_status.try(:ga_2) ? '完了' : '未' %></td>
        <td>
          <%= @user.javascript_status.try(:ga_2_completion) if @user.javascript_status.ga_2_completion.present? %>
          <%= form_for(@user.javascript_status, url: javascript_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "javascript_ga_2"%>
          <% end %>
        </td>
        <td class="center">約半日</td>  
        <td><%= @user.javascript_status.try(:ga_2_compd) %></td>
      </tr>
      <tr>
        <td>学習コース 3</td>
        <td class="center"><%= @user.javascript_status.try(:ga_3) ? '完了' : '未' %></td>
        <td>
          <%= @user.javascript_status.try(:ga_3_completion) if @user.javascript_status.ga_3_completion.present? %>
          <%= form_for(@user.javascript_status, url: javascript_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "javascript_ga_3"%>
          <% end %>
        </td>
        <td class="center">約半日</td>  
        <td><%= @user.javascript_status.try(:ga_3_compd)%></td>
      </tr>
      <tr>
        <td>学習コース 4</td>
        <td class="center"><%= @user.javascript_status.try(:ga_4) ? '完了' : '未' %></td>
        <td>
          <%= @user.javascript_status.try(:ga_4_completion) if @user.javascript_status.ga_4_completion.present? %>
          <%= form_for(@user.javascript_status, url: javascript_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "javascript_ga_4"%>
          <% end %>
        </td>
        <td class="center">約半日</td>
        <td><%= @user.javascript_status.try(:ga_4_compd)%></td>
      </tr>      
      <tr>
        <td>学習コース　5</td>
        <td class="center"><%= @user.javascript_status.try(:do_1) ? '完了' : '未' %></td>
        <td>
          <%= @user.javascript_status.try(:do_1_completion) if @user.javascript_status.do_1_completion.present? %>
          <%= form_for(@user.javascript_status, url: javascript_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "javascript_do_1"%>
          <% end %>
        </td>
        <td class="center">約1日</td>
        <td><%= @user.javascript_status.try(:do_1_compd)%></td>
      </tr>
    </tbody>
  </table>
  
  <table class="txt1 table-condensed table-status-schedule">
     <tr valign="baseline">
      <td width="60%">
        <h3 class="txt3">[Progate] Ruby</h3>
      </td>
    </tr>
  </table>
 
  <!--進捗線を表示-->
  <progress id="ruby_progress" value="0" max="5"></progress>
  <output id="ruby_output"></output>

<script>
    let current_status3 = <%= count_ruby(@user) %>;
    let total_course_num3 = document.getElementById('ruby_progress').max;
    
    function countup() {
        document.getElementById('ruby_progress').value = current_status3;
        document.getElementById('ruby_output').value = '進捗率：' + (current_status3 / total_course_num3 * 100).toFixed() + '%';
    }

    setInterval(countup, 1000);
</script>
  
  <table class="txt1 table table-bordered table-striped table-condensed table-status">
    <thead>
      <tr>
        <th class="table-header">コース</th>
        <th class="table-header">状況</th>
        <th class="table-header">完了予定日</th>
        <th class="table-header">目安(日)</th>
        <th class="table-header">完了日</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>学習コース 1</td>
        <td class="center"><%= @user.ruby_status.try(:ga_1) ? '完了' : '未' %></td>
        <td>
          <%= @user.ruby_status.try(:ga_1_completion) if @user.ruby_status.ga_1_completion.present? %>
          <%= form_for(@user.ruby_status, url: ruby_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "ruby_ga_1"%>
          <% end %>
        </td>
        <td class="center">約1日</td>
        <td><%= @user.ruby_status.try(:ga_1_compd) %></td>
      </tr>
      <tr>
        <td>学習コース 2</td>
        <td class="center"><%= @user.ruby_status.try(:ga_2) ? '完了' : '未' %></td>
        <td>
          <%= @user.ruby_status.try(:ga_2_completion) if @user.ruby_status.ga_2_completion.present? %>
          <%= form_for(@user.ruby_status, url: ruby_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "ruby_ga_2"%>
          <% end %>
        </td>
        <td class="center">約1日</td>
        <td><%= @user.ruby_status.try(:ga_2_compd) %></td>
      </tr>
      <tr>
        <td>学習コース 3</td>
        <td class="center"><%= @user.ruby_status.try(:ga_3) ? '完了' : '未' %></td>
        <td>
          <%= @user.ruby_status.try(:ga_3_completion) if @user.ruby_status.ga_3_completion.present? %>
          <%= form_for(@user.ruby_status, url: ruby_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "ruby_ga_3"%>
          <% end %>
        </td>
        <td class="center">約1日</td>
        <td><%= @user.ruby_status.try(:ga_3_compd) %></td>
      </tr>
      <tr>
        <td>学習コース 4</td>
        <td class="center"><%= @user.ruby_status.try(:ga_4) ? '完了' : '未' %></td>
        <td>
          <%= @user.ruby_status.try(:ga_4_completion) if @user.ruby_status.ga_4_completion.present? %>
          <%= form_for(@user.ruby_status, url: ruby_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "ruby_ga_4"%>
          <% end %>
        </td>
        <td class="center">約1日</td>
        <td><%= @user.ruby_status.try(:ga_4_compd) %></td>
      </tr>
      <tr>
        <td>学習コース 5</td>
        <td class="center"><%= @user.ruby_status.try(:ga_5) ? '完了' : '未' %></td>
        <td>
          <%= @user.ruby_status.try(:ga_5_completion) if @user.ruby_status.ga_5_completion.present? %>
          <%= form_for(@user.ruby_status, url: ruby_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "ruby_ga_5"%>
          <% end %>
        </td>
        <td class="center">約1日</td>
        <td><%= @user.ruby_status.try(:ga_5_compd) %></td>
      </tr>
    </tbody>
  </table>
  
  <table class="txt1 table-condensed table-status-schedule">
     <tr valign="baseline">
      <td width="60%">
        <h3 class="txt3">[Progate] Ruby on Rails</h3>
      </td>
    </tr>
  </table>
  
  <!--進捗線を表示-->
  <progress id="rubyonrails_progress" value="0" max="15"></progress>
  <output id="rubyonrails_output"></output>

<script>
    let current_status4 = <%= count_ruby_on_rails(@user) %>;
    let total_course_num4 = document.getElementById('rubyonrails_progress').max;
    
    function countup() {
        document.getElementById('rubyonrails_progress').value = current_status4;
        document.getElementById('rubyonrails_output').value = '進捗率：' + (current_status4 / total_course_num4 * 100).toFixed() + '%';
    }

    setInterval(countup, 1000);
</script>

  <table class="txt1 table table-bordered table-striped table-condensed table-status">
    <thead>
      <tr>
        <th class="table-header">コース</th>
        <th class="table-header">状況</th>
        <th class="table-header">完了予定日</th>
        <th class="table-header">目安(日)</th>
        <th class="table-header">完了日</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>学習コース 1</td>
        <td class="center"><%= @user.rubyonrails_status.try(:ga_1) ? '完了' : '未' %></td>
        <td>
          <%= @user.rubyonrails_status.try(:ga_1_completion) if @user.rubyonrails_status.ga_1_completion.present? %>
          <%= form_for(@user.rubyonrails_status, url: rubyonrails_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "rubyonrails_ga_1"%>
          <% end %>
        </td>
        <td class="center">約半日</td>
        <td><%= @user.rubyonrails_status.try(:ga_1_compd) %></td>
      </tr>
  
      <tr>
        <td>学習コース 2</td>
        <td class="center"><%= @user.rubyonrails_status.try(:ga_2) ? '完了' : '未' %></td>
        <td>
          <%= @user.rubyonrails_status.try(:ga_2_completion) if @user.rubyonrails_status.ga_2_completion.present? %>
          <%= form_for(@user.rubyonrails_status, url: rubyonrails_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "rubyonrails_ga_2"%>
          <% end %>
        </td>
        <td class="center">約半日</td>
        <td><%= @user.rubyonrails_status.try(:ga_2_compd) %></td>
      </tr>
  
      <tr>
        <td>学習コース 3</td>
        <td class="center"><%= @user.rubyonrails_status.try(:ga_3) ? '完了' : '未' %></td>
        <td>
          <%= @user.rubyonrails_status.try(:ga_3_completion) if @user.rubyonrails_status.ga_3_completion.present? %>
          <%= form_for(@user.rubyonrails_status, url: rubyonrails_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "rubyonrails_ga_3"%>
          <% end %>
        </td>
        <td class="center">約半日</td>
        <td><%= @user.rubyonrails_status.try(:ga_3_compd) %></td>
      </tr>
  
      <tr>
        <td>学習コース 4</td>
        <td class="center"><%= @user.rubyonrails_status.try(:ga_4) ? '完了' : '未' %></td>
        <td>
          <%= @user.rubyonrails_status.try(:ga_4_completion) if @user.rubyonrails_status.ga_4_completion.present? %>
          <%= form_for(@user.rubyonrails_status, url: rubyonrails_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "rubyonrails_ga_4"%>
          <% end %>
        </td>
        <td class="center">約半日</td>
        <td><%= @user.rubyonrails_status.try(:ga_4_compd) %></td>
      </tr>
  
      <tr>
        <td>学習コース 5</td>
        <td class="center"><%= @user.rubyonrails_status.try(:ga_5) ? '完了' : '未' %></td>
        <td>
          <%= @user.rubyonrails_status.try(:ga_5_completion) if @user.rubyonrails_status.ga_5_completion.present? %>
          <%= form_for(@user.rubyonrails_status, url: rubyonrails_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "rubyonrails_ga_5"%>
          <% end %>
        </td>
        <td class="center">約半日</td>
        <td><%= @user.rubyonrails_status.try(:ga_5_compd) %></td>
      </tr>
  
      <tr>
        <td>学習コース 6</td>
        <td class="center"><%= @user.rubyonrails_status.try(:ga_6) ? '完了' : '未' %></td>
        <td>
          <%= @user.rubyonrails_status.try(:ga_6_completion) if @user.rubyonrails_status.ga_6_completion.present? %>
          <%= form_for(@user.rubyonrails_status, url: rubyonrails_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "rubyonrails_ga_6"%>
          <% end %>
        </td>
        <td class="center">約半日</td>
        <td><%= @user.rubyonrails_status.try(:ga_6_compd) %></td>
      </tr>
  
      <tr>
        <td>学習コース 7</td>
        <td class="center"><%= @user.rubyonrails_status.try(:ga_7) ? '完了' : '未' %></td>
        <td>
          <%= @user.rubyonrails_status.try(:ga_7_completion) if @user.rubyonrails_status.ga_7_completion.present? %>
          <%= form_for(@user.rubyonrails_status, url: rubyonrails_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "rubyonrails_ga_7"%>
          <% end %>
        </td>
        <td class="center">約半日</td>
        <td><%= @user.rubyonrails_status.try(:ga_7_compd) %></td>
      </tr>
  
      <tr>
        <td>学習コース 8</td>
        <td class="center"><%= @user.rubyonrails_status.try(:ga_8) ? '完了' : '未' %></td>
        <td>
          <%= @user.rubyonrails_status.try(:ga_8_completion) if @user.rubyonrails_status.ga_8_completion.present? %>
          <%= form_for(@user.rubyonrails_status, url: rubyonrails_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "rubyonrails_ga_8"%>
          <% end %>
        </td>
        <td class="center">約半日</td>
        <td><%= @user.rubyonrails_status.try(:ga_8_compd) %></td>
      </tr>
  
      <tr>
        <td>学習コース 9</td>
        <td class="center"><%= @user.rubyonrails_status.try(:ga_9) ? '完了' : '未' %></td>
        <td>
          <%= @user.rubyonrails_status.try(:ga_9_completion) if @user.rubyonrails_status.ga_9_completion.present? %>
          <%= form_for(@user.rubyonrails_status, url: rubyonrails_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "rubyonrails_ga_9"%>
          <% end %>
        </td>
        <td class="center">約半日</td>
        <td><%= @user.rubyonrails_status.try(:ga_9_compd) %></td>
      </tr>
  
      <tr>
        <td>学習コース 10</td>
        <td class="center"><%= @user.rubyonrails_status.try(:ga_10) ? '完了' : '未' %></td>
        <td>
          <%= @user.rubyonrails_status.try(:ga_10_completion) if @user.rubyonrails_status.ga_10_completion.present? %>
          <%= form_for(@user.rubyonrails_status, url: rubyonrails_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "rubyonrails_ga_10"%>
          <% end %>
        </td>
        <td class="center">約半日</td>
        <td><%= @user.rubyonrails_status.try(:ga_10_compd) %></td>
      </tr>
  
      <tr>
        <td>学習コース 11</td>
        <td class="center"><%= @user.rubyonrails_status.try(:ga_11) ? '完了' : '未' %></td>
        <td>
          <%= @user.rubyonrails_status.try(:ga_11_completion) if @user.rubyonrails_status.ga_11_completion.present? %>
          <%= form_for(@user.rubyonrails_status, url: rubyonrails_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "rubyonrails_ga_11"%>
          <% end %>
        </td>
        <td class="center">約半日</td>
        <td><%= @user.rubyonrails_status.try(:ga_11_compd) %></td>
      </tr>
  
      <tr>
        <td>道場コース 1</td>
        <td class="center"><%= @user.rubyonrails_status.try(:do_1) ? '完了' : '未' %></td>
        <td>
          <%= @user.rubyonrails_status.try(:do_1_completion) if @user.rubyonrails_status.do_1_completion.present? %>
          <%= form_for(@user.rubyonrails_status, url: rubyonrails_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "rubyonrails_do_1"%>
          <% end %>
        </td>
        <td class="center">約1日</td>
        <td><%= @user.rubyonrails_status.try(:do_1_compd) %></td>
      </tr>
  
      <tr>
        <td>道場コース 2</td>
        <td class="center"><%= @user.rubyonrails_status.try(:do_2) ? '完了' : '未' %></td>
        <td>
          <%= @user.rubyonrails_status.try(:do_2_completion) if @user.rubyonrails_status.do_2_completion.present? %>
          <%= form_for(@user.rubyonrails_status, url: rubyonrails_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "rubyonrails_do_2"%>
          <% end %>
        </td>
        <td class="center">約1日</td>
        <td><%= @user.rubyonrails_status.try(:do_2_compd) %></td>
      </tr>
  
      <tr>
        <td>道場コース 3</td>
        <td class="center"><%= @user.rubyonrails_status.try(:do_3) ? '完了' : '未' %></td>
        <td>
          <%= @user.rubyonrails_status.try(:do_3_completion) if @user.rubyonrails_status.do_3_completion.present? %>
          <%= form_for(@user.rubyonrails_status, url: rubyonrails_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "rubyonrails_do_3"%>
          <% end %>
        </td>
        <td class="center">約1日</td>
        <td><%= @user.rubyonrails_status.try(:do_3_compd) %></td>
      </tr>
  
      <tr>
        <td>道場コース 4</td>
        <td class="center"><%= @user.rubyonrails_status.try(:do_4) ? '完了' : '未' %></td>
        <td>
          <%= @user.rubyonrails_status.try(:do_4_completion) if @user.rubyonrails_status.do_4_completion.present? %>
          <%= form_for(@user.rubyonrails_status, url: rubyonrails_completion_path ) do |f| %>
            <input style="width:60%" type="date" name="date">
            <%= f.submit "登録", class: "btn btn-default active" %>
            <%= f.hidden_field :id, :value => "#{@user.id}"%>
            <%= f.hidden_field :course, :value => "rubyonrails_do_4"%>
          <% end %>
        </td>
        <td class="center">約1日</td>
        <td><%= @user.rubyonrails_status.try(:do_4_compd) %></td>
      </tr>
    </tbody>
  </table>
  
  <table class="txt1 table-condensed table-status-schedule">
     <tr valign="baseline">
      <td width="60%">
        <h3 class="txt3">誰でもわかる勤怠システム</h3>
        完了予定日：<%= @user.railstutorial_status.try(:schedule_date) if @user.railstutorial_status.schedule_date.present? %></span></h3>
        <br>目安日数：約30日
      </td>
      <td>
        <%= form_for(@user.railstutorial_status, url: railstutorial_schedule_path ) do |f| %>
        <input style="width:100%" type="date" name="date">
      </td>
      <td width="20%">
        <%= f.submit "登録", class: "btn btn-default active" %>
        <%= f.hidden_field :id, :value => "#{@user.id}" %>
        <% end %>
      </td>
    </tr>
  </table>
  
  <!--進捗線を表示-->
  <progress id="rails_tutorial_progress" value="0" max="10"></progress>
  <output id="rails_tutorial_output"></output>

<script>
    let current_status5 = <%= count_rails_tutorial(@user) %>;
    let total_course_num5 = document.getElementById('rails_tutorial_progress').max;
    
    function countup() {
        document.getElementById('rails_tutorial_progress').value = current_status5;
        document.getElementById('rails_tutorial_output').value = '進捗率：' + (current_status5 / total_course_num5 * 100).toFixed() + '%';
    }

    setInterval(countup, 1000);
</script>

  <table class="txt1 table table-bordered table-condensed table-status">
    <tr>
      <td class="table-header">完了した章</td>
      <td class="center"><%= count_rails_tutorial(@user) %>章</td>
    </tr>
  </table>

  
  
  <table class="txt1 table-condensed table-status-schedule">
     <tr valign="baseline">
      <td width="60%">
        <h3 class="txt3">動画視聴</h3>
        完了予定日：<%= @user.user_movie_status.try(:schedule_date) if @user.user_movie_status.schedule_date.present? %></span></h3>
        <br>目安日数：約2日
      </td>
      <td>
        <%= form_for(@user.user_movie_status, url: user_movie_schedule_path) do |f| %>
        <input style="width:100%" type="date" name="date">
      </td>
      <td width="20%">
        <%= f.submit "登録", class: "btn btn-default active" %>
        <%= f.hidden_field :id, :value => "#{@user.id}" %>
        <% end %>
      </td>
    </tr>
  </table>
  
    <!--進捗線を表示-->
  <progress id="movie_progress" value="0" max="100"></progress>
  <output id="movie_output"></output>

<script>
    var movie_status = [];
    movie_status = <%= count_movie(@user) %>;
    // let total_course_num5 = document.getElementById('rails_tutorial_progress').max;
    
    function countup() {
        document.getElementById('movie_progress').max = movie_status[0];
        document.getElementById('movie_progress').value = movie_status[1];
        document.getElementById('movie_output').value = '進捗率：' + (movie_status[1] / movie_status[0] * 100).toFixed() + '%';
    }

    setInterval(countup, 1000);
</script>

  <table class="txt1 table table-bordered table-striped table-condensed table-status" style="table-layout: fixed;">
    <thead>
      <tr>
        <th width=25% class="table-header">動画名</th>
        <th width=15% class="table-header">状況</th>
        <th class="table-header">感想</th>
      </tr>
    </thead>
    <% @categories.each do |category| %>
      <% category.movies.order('sort_order').each do |movie| %>
        <% feedback = @user.feedbacks.find_by(movie_id: movie.id) %>
        <tbody>
          <tr>
            <td><%= movie.title %></td>
            <td class="center"><%= feedback.present? ? '完了' : '未' %></td>
            <td style="word-wrap:break-word;"><%= feedback.present? ? feedback.feedback : '-' %></td>
          </tr>
        </tbody>
      <% end %>
    <% end %>
  </table>
  
  <div class="right">
    <%= link_to 'ユーザ編集', edit_user_path(@user) , class: 'btn btn-default active' %>
    <% if current_user.admin %>
      <%= link_to 'ユーザ削除', @user, method: :delete, class: 'btn btn-danger',
          data: { confirm: '本当に削除しますか？' } %>
    <% end %>
  </div>
  
  
  <script>
  $('.edit-my-picture').click(function(){
    $('#upload-my-picture').show();
    $(this).hide();
  });
  </script>
  
</div>