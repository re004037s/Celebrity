<h1 class="txt2">進捗詳細</h1>

<h2 class="txt3">
  <%= @user.nickname %>
  [ <%= @user.name %> ]
</h2>

<div class="align-center">
  <% if @user.picture_file %>
  <%= image_tag(get_image_user_path) %>
  <% else %>
  <%= image_tag('default.png') %>
  <% end %>
</div>


<div class="align-center">
  <button type="button" class="edit-my-picture btn btn-primary" >写真を編集する</button>
</div>

<div id="upload-my-picture" class="align-center">
  
  <%= form_for(@user, url: post_pic_path, :id => 'form_id' ) do |f| %>
  <div class="form-group has-error">
    <span id="__has-warning" style="color: red;">画像を選択してください</span>
    <%= f.file_field :picture, accept: 'image/*' %>
    <%= f.submit '画像をアップロード', id: 'fileuploader', class: 'btn btn-primary fileuploader', :disabled => 'true' %>
  </div>
  <% end %>
  
  <script type="text/javascript">
    $('#user_picture').bind('change', function() {
      
    let size_in_megabytes = this.files[0].size/1024/1024;
    
    // 画像未選択の場合
    if (size_in_megabytes === null){
      $("#fileuploader").prop("disabled", true);
      $('#__has-warning').show();
    }
    
    // 画像のサイズが5MBを超える場合
    if (size_in_megabytes > 5) {
      $('#__has-warning').text('5MB以下のファイルを選択してください。');
      $('#__has-warning').css('color','red');
      $('#__has-warning').show();
      $("#fileuploader").prop("disabled", true);
    
    // 画像のサイズが5MB以下の場合（正常）
     }else if (size_in_megabytes <= 5){
       $('#__has-warning').text('アップロードできます');
       $('#__has-warning').css('color','blue');
       $("#fileuploader").prop("disabled", false);
     }
     
    });
  </script>
</div>


<div id="tag-controll">
  
<%= form_for(@user, url: tag_show_path) do |f| %>
  <%= f.text_field :tags , value:'', placeholder: 'タグを入力【20文字(英字or半角スペース)までOK】' %>
  <%= f.submit '登録', id:'tag-submit', class: 'btn btn-primary', :disabled => 'true' %>
<% end %>

<p>サジェスト機能のテスト用（下に表示されます）</p>
<ul id="result">

<!-- この中に<li>デデデ大王</li>みたいに検索候補を追加していきます -->
</ul>

<p>登録済みのタグ一覧：</p>
<% @user_tags.each do |user_tag| %>
  <span class="tag_box">
    <span class="tag_displayed">
      <%= user_tag.tag %>
    </span>
    <%= link_to image_tag('delete_icon.png', :class => 'delete_icon'), delete_tag_path(user_id: current_user.id, tag_id: user_tag.id), :method => :delete %>　<!-- methodでdeleteを指定する--> 
  </span>
<% end %>
</div>


<div id="modal-content" class="table-responsive" style="display:none;">
  <table class="table table-bordered table-hover table-striped">
    <thead>
      <tr>
        <th>ID</th>
        <th>名前</th>
        <th>ニックネーム</th>
        <th class="profile-pic">画像</th>
        <th>登録タグ</th>
      </tr>
    </thead>
    <tbody id="tags_for_tbody">
    </tbody>
  </table>
</div>

<div id="modal-overlay" style="background:gray; opacity:0.5;"></div>

<script>

//グローバル変数 (関数外)
let sX_syncerModal = 0 ;
let sY_syncerModal = 0 ;
let cnt = 0;
let w, h, wW, wH, ww, hh = 0;


let tag_displayed_objs = document.getElementsByClassName("tag_displayed");
for(let i = 0, len = tag_displayed_objs.length; i < len; i++){
  tag_displayed_objs[i].addEventListener(
    "click", showModalForm
  );
  tag_displayed_objs[i].addEventListener(
    "click", displayUserTagRelation
  );
}


$(window).resize(function(){
  cnt = 0;
});

function showModalForm(){
  if($('#tags_for_tbody').children().remove()){
    $('#tags_for_tbody').children().remove();
  };
  

  //スクロール位置を記録
  var dElm = document.documentElement , dBody = document.body;
  sX_syncerModal = dElm.scrollLeft || dBody.scrollLeft;	//現在位置のX座標
  sY_syncerModal = dElm.scrollTop || dBody.scrollTop;		//現在位置のY座標

	//キーボード操作などにより、オーバーレイが多重起動するのを防止する
  $(this).blur() ;	//ボタンからフォーカスを外す
  //if($("#modal-overlay")[0]) return false ;		//新しくモーダルウィンドウを起動しない [下とどちらか選択]
  if($("#modal-overlay")) $("#modal-overlay").remove() ;		//現在のモーダルウィンドウを削除して新しく起動する [上とどちらか選択]
  

  
  if (cnt == 0){
    var w = $(window).width();
    var h = $(window).height();

    var cw = $("#modal-content").outerWidth();
    var ch = $("#modal-content").outerHeight();
    
    var sc = $(window).scrollTop();
    
    $("#modal-content").css({
      "left": ((w - cw) / 2 ) + "px",
      "top": ( h * 1 / 8) + "px"
    });
    cnt += 1;
  }
  
  //オーバーレイ用のHTMLコードを、[body]内の最後に生成する
  $("body").append('<div id="modal-overlay"></div>');
  
  //[$modal-content]をフェードインさせる
  $("#modal-content").fadeIn("slow");
  
  //[$modal-overlay]をフェードインさせる
  $("#modal-overlay").fadeIn("slow");
  
  centeringModalSyncer();
  
  $(window).resize(centeringModalSyncer);
  
  
  $("#modal-overlay").unbind().click(function(){
  	//[#modal-overlay]と[#modal-close]をフェードアウトする
    $("#modal-content, #modal-overlay").fadeOut("slow",function(){
  	//フェードアウト後、[#modal-overlay]をHTML(DOM)上から削除
  	  $("#modal-overlay").remove();
      $('#tags_for_tbody').children().remove();
      
      //スクロール位置を移動
      window.scrollTo( sX_syncerModal , sY_syncerModal );
    });
  });
}




//センタリングをする関数
function centeringModalSyncer(){

	//画面(ウィンドウ)の幅を取得し、変数[w]に格納
	var w = $(window).width();

	//画面(ウィンドウ)の高さを取得し、変数[h]に格納
	var h = $(window).height();
	
	//スマホ対応する場合
	//画面(ウィンドウ)の高さを取得し、変数[h]に格納
  //var h = window.innerHeight;

	//コンテンツ(#modal-content)の幅を取得し、変数[cw]に格納
	var cw = $("#modal-content").outerWidth({margin:true});

	//コンテンツ(#modal-content)の高さを取得し、変数[ch]に格納
	var ch = $("#modal-content").outerHeight({margin:true});

	//コンテンツ(#modal-content)を真ん中に配置するのに、左端から何ピクセル離せばいいか？を計算して、変数[pxleft]に格納
	var pxleft = ((w - cw)/2);

	//コンテンツ(#modal-content)を真ん中に配置するのに、上部から何ピクセル離せばいいか？を計算して、変数[pxtop]に格納
	var pxtop = ((h - ch)/2);

	//[#modal-content]のCSSに[left]の値(pxleft)を設定
	$("#modal-content").css({"left": pxleft + "px"});

	//[#modal-content]のCSSに[top]の値(pxtop)を設定
	$("#modal-content").css({"top": pxtop + "px"});

}


$('#user_tags').keyup(function(e) {
  e.preventDefault(); //キャンセル可能なイベントをキャンセル
  let text_field_obj = $('#tag-submit').parent('.edit_user').find('#user_tags');
  let words = $.trim(text_field_obj.val());
  if(words.length == 0 ){
    $('#result').find('li').remove();
    return;
  };
  if(words.length >= 1 && words.length <= 20){
    $("#tag-submit").prop("disabled", false);
  }else{
    $("#tag-submit").prop("disabled", true);
  }
  

  //inputに入力した文字列をリアルタイムでajaxリクエストする
  $.ajax({ //ajax通信で以下のことを行います
    url: '/users/search', //urlを指定
    type: 'GET', //メソッドを指定
    data: ('keyword=' + words), //コントローラーに渡すデータを'keyword=input(入力された文字のことですね)'にするように指定
    processData: false, //おまじない
    contentType: false, //おまじない
    dataType: 'json' //データ形式を指定
  })
  //ajax request success時の処理
  .done(function(response){ //データを受け取ることに成功したら、dataを引数に取って以下のことする(dataには@usersが入っている状態ですね)
    // $('#result').find('li').remove();  //idがresultの子要素のliを削除する
    $(response).each(function(i, fetchedTag){ //dataをuserという変数に代入して、以下のことを繰り返し行う(単純なeach文ですね)
      $('#result').append('<li>' + fetchedTag.tag + '</li>') //resultというidの要素に対して、<li>ユーザーの名前</li>を追加する。
    });
  })
});


function createTd_html(user_info){
  let tmp = '';
  for(let i = 0, len = user_info.length; i < len; i++){
    tmp += '<td>' + user_info[i] + '</td>';
  }
  return tmp;
}

let tags_arrays = [];
function displayUserTagRelation() {
  $('.tag_appeared').off('click');
  let clicked_tag_name = $.trim($(this).text());
    //clickしたタグ名に紐づくユーザー情報をリアルタイムでajaxリクエストする
  $.ajax({ //ajax通信で以下のことを行います
    url: '/users/tag_related', //urlを指定
    type: 'GET', //メソッドを指定
    data: ('tag_name=' + clicked_tag_name), 
    contentType: false, //おまじない
    dataType: 'json' //データ形式を指定
  })
  //ajax request success時の処理
  .done(function(res){ 
      
    $(res).each(function(i, user_info){
      let user_id = user_info[0]
      let picture_file = user_info[3];
      if (picture_file == null){
         user_info[3] = '<img src="' + "/assets/default.png" + '" />'
      }
      
      let _tr_html = '<tr>';
      _tr_html += createTd_html(user_info);
      _tr_html += '<td id="' + user_id   + '">' + '' + '</td>';
      _tr_html += '</tr>';
       
      $('#tags_for_tbody').append(_tr_html) 
      
      //user_id をキーにしてuserに紐づくタグを取得する  
      $.ajax({ //ajax通信で以下のことを行います
        url: '/users/tags_belongs_to_user', //urlを指定
        type: 'GET', //メソッドを指定
        data: ('userid=' + user_id), 
        contentType: false, //おまじない
        dataType: 'json' //データ形式を指定
      })
      
      .done(function(tags_row){
        // let tmp = [];
        let _tag_field = '';
        $(tags_row).each(function(i, tag_row){
          // tmp.push(tag_row.tag);
          // debugger
          for(let key in tag_row){
            for(let j in tag_row[key]){
              //click event をつけて再帰的にこのajaxを実行させる
              _tag_field += '<span '+ 'class="'+ 'tag_appeared__userid_' + key +'">'
              _tag_field += tag_row[key][j].tag 
              _tag_field += '</span>'
              _tag_field += '</br>'
              $('#' + key  + '').append(_tag_field);
            }
            
            let tag_appeared_obj = $(".tag_appeared__userid_" + key);
            tag_appeared_obj.click(showModalForm);
            tag_appeared_obj.click(displayUserTagRelation)
            
            
          }
          
        })
        
      })
      
    });
  })
}

  $(window).scroll(function() {
  let scroll_y = $(window).scrollTop();
  $('#modal-layer').offset({ top: scroll_y, left: 0 });
});

  $('.delete_icon').css('width', '15');
  $('.tag_box').css('border', 'solid 1px #000000');
  $('.tag_box').css('margin', '0 3px 0 0');
  $('.tag_box').css('padding', '2 2');
  $('.tag_box').css('font-size', '1.3em');
  $('#tag-controll').css('width', '60%');
  $('#tag-controll').css('margin', '1em auto');
  
</script>
  
<table class="txt1 table-condensed table-status-schedule">
   <tr valign="baseline">
     <td width="60%">
      <h3 class="txt3">[Progate] HTML&CSS<span class="font-schedule">完了予定日
      <%= @user.html_css_status.try(:schedule_date) if @user.html_css_status.schedule_date.present? %></span></h3>
      </td>
      <td>
      <%= form_for(@user.html_css_status, url: html_css_schedule_path ) do |f| %>
      <input style="width:100%" type="date" name="date">
      </td>
      <td width="20%">
      <%= f.submit "登録", class: "btn btn-schedule" %>
      <% end %>
      </td>
  </tr>
</table>
<table class="txt1 table table-bordered table-striped table-condensed table-status">
  <thead>
    <tr>
      <th class="table-header">コース</th>
      <th class="table-header">ステータス</th>
      <th class="table-header">完了日</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>学習コース/初級</td>
      <td class="center"><%= @user.html_css_status.try(:ga_beginner) ? '完了' : '未' %></td>
      <td><%= @user.html_css_status.try(:ga_beginner_compd) %></td>
    </tr>
    <tr>
      <td>学習コース/中級</td>
      <td class="center"><%= @user.html_css_status.try(:ga_middle) ? '完了' : '未' %></td>
      <td><%= @user.html_css_status.try(:ga_middle_compd) %></td>
    </tr>
    <tr>
      <td>学習コース/上級</td>
      <td class="center"><%= @user.html_css_status.try(:ga_advanced) ? '完了' : '未' %></td>
      <td><%= @user.html_css_status.try(:ga_advanced_compd) %></td>
    </tr>
    <tr>
      <td>道場コース/初級</td>
      <td class="center"><%= @user.html_css_status.try(:do_beginner) ? '完了' : '未' %></td>
      <td><%= @user.html_css_status.try(:do_beginner_compd) %></td>
    </tr>
    <tr>
      <td>道場コース/中級</td>
      <td class="center"><%= @user.html_css_status.try(:do_middle) ? '完了' : '未' %></td>
      <td><%= @user.html_css_status.try(:do_middle_compd) %></td>
    </tr>
    <tr>
      <td>道場コース/上級</td>
      <td class="center"><%= @user.html_css_status.try(:do_advanced) ? '完了' : '未' %></td>
      <td><%= @user.html_css_status.try(:do_advanced_compd) %></td>
    </tr>
    <tr>
      <td>実践コース 1</td>
      <td class="center"><%= @user.html_css_status.try(:ji_1) ? '完了' : '未' %></td>
      <td><%= @user.html_css_status.try(:ji_1_compd) %></td>
    </tr>
    <tr>
      <td>実践コース 2</td>
      <td class="center"><%= @user.html_css_status.try(:ji_2) ? '完了' : '未' %></td>
      <td><%= @user.html_css_status.try(:ji_2_compd) %></td>
    </tr>
  </tbody>
</table>


<table class="txt1 table-condensed table-status-schedule">
   <tr valign="baseline">
    <td width="60%">
      <h3 class="txt3">[Progate] JavaScript<span class="font-schedule">完了予定日
      <%= @user.javascript_status.try(:schedule_date) if @user.javascript_status.schedule_date.present? %><span class="font-schedule"></h3>
    </td>
    <td>
      <%= form_for(@user.javascript_status, url: javascript_schedule_path ) do |f| %>
      <input style="width:100%" type="date" name="date">
    </td>
    <td width="20%">
      <%= f.submit "登録", class: "btn btn-schedule" %>
      <% end %>
    </td>
  </tr>
</table>
<table class="txt1 table table-bordered table-striped table-condensed table-status">
  <thead>
    <tr>
      <th class="table-header">コース</th>
      <th class="table-header">ステータス</th>
      <th class="table-header">完了日</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>学習コース 1</td>
      <td class="center"><%= @user.javascript_status.try(:ga_1) ? '完了' : '未' %></td>
      <td><%= @user.javascript_status.try(:ga_1_compd)%></td>
    </tr>
    <tr>
      <td>学習コース 2</td>
      <td class="center"><%= @user.javascript_status.try(:ga_2) ? '完了' : '未' %></td>
      <td><%= @user.javascript_status.try(:do_2_compd) %></td>
    </tr>
    <tr>
      <td>学習コース 3</td>
      <td class="center"><%= @user.javascript_status.try(:ga_3) ? '完了' : '未' %></td>
      <td><%= @user.javascript_status.try(:ga_3_compd)%></td>
    </tr>
    <tr>
      <td>学習コース 4</td>
      <td class="center"><%= @user.javascript_status.try(:ga_4) ? '完了' : '未' %></td>
      <td><%= @user.javascript_status.try(:ga_4_compd)%></td>
    </tr>      
    <tr>
      <td>道場コース 1</td>
      <td class="center"><%= @user.javascript_status.try(:do_1) ? '完了' : '未' %></td>
      <td><%= @user.javascript_status.try(:do_1_compd)%></td>
    </tr>
  </tbody>
</table>

<table class="txt1 table-condensed table-status-schedule">
   <tr valign="baseline">
    <td width="60%">
      <h3 class="txt3">[Progate] Ruby<span class="font-schedule">完了予定日
      <%= @user.ruby_status.try(:schedule_date) if @user.ruby_status.schedule_date.present? %></span></h3>
    </td>
    <td>
      <%= form_for(@user.ruby_status, url: ruby_schedule_path ) do |f| %>
      <input style="width:100%" type="date" name="date">
    </td>
    <td width="20%">
      <%= f.submit "登録", class: "btn btn-schedule" %>
      <% end %>
    </td>
  </tr>
</table>
<table class="txt1 table table-bordered table-striped table-condensed table-status">
  <thead>
    <tr>
      <th class="table-header">コース</th>
      <th class="table-header">ステータス</th>
      <th class="table-header">完了日</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>学習コース 1</td>
      <td class="center"><%= @user.ruby_status.try(:ga_1) ? '完了' : '未' %></td>
      <td><%= @user.ruby_status.try(:ga_1_compd) %></td>
    </tr>
    <tr>
      <td>学習コース 2</td>
      <td class="center"><%= @user.ruby_status.try(:ga_2) ? '完了' : '未' %></td>
      <td><%= @user.ruby_status.try(:ga_2_compd) %></td>
    </tr>
    <tr>
      <td>学習コース 3</td>
      <td class="center"><%= @user.ruby_status.try(:ga_3) ? '完了' : '未' %></td>
      <td><%= @user.ruby_status.try(:ga_3_compd) %></td>
    </tr>
    <tr>
      <td>学習コース 4</td>
      <td class="center"><%= @user.ruby_status.try(:ga_4) ? '完了' : '未' %></td>
      <td><%= @user.ruby_status.try(:ga_4_compd) %></td>
    </tr>
    <tr>
      <td>学習コース 5</td>
      <td class="center"><%= @user.ruby_status.try(:ga_5) ? '完了' : '未' %></td>
      <td><%= @user.ruby_status.try(:ga_5_compd) %></td>
    </tr>
  </tbody>
</table>

<table class="txt1 table-condensed table-status-schedule">
   <tr valign="baseline">
    <td width="60%">
      <h3 class="txt3">[Progate] Ruby on Rails<span class="font-schedule">完了予定日
      <%= @user.rubyonrails_status.try(:schedule_date) if @user.rubyonrails_status.schedule_date.present? %></span></h3>
    </td>
    <td>
      <%= form_for(@user.rubyonrails_status, url: rubyonrails_schedule_path ) do |f| %>
      <input style="width:100%" type="date" name="date">
    </td>
    <td width="20%">
      <%= f.submit "登録", class: "btn btn-schedule" %>
      <% end %>
    </td>
  </tr>
</table>
<table class="txt1 table table-bordered table-striped table-condensed table-status">
  <thead>
    <tr>
      <th class="table-header">コース</th>
      <th class="table-header">ステータス</th>
      <th class="table-header">完了日</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>学習コース 1</td>
      <td class="center"><%= @user.rubyonrails_status.try(:ga_1) ? '完了' : '未' %></td>
      <td><%= @user.rubyonrails_status.try(:ga_1_compd) %></td>
    </tr>

    <tr>
      <td>学習コース 2</td>
      <td class="center"><%= @user.rubyonrails_status.try(:ga_2) ? '完了' : '未' %></td>
      <td><%= @user.rubyonrails_status.try(:ga_2_compd) %></td>
    </tr>

    <tr>
      <td>学習コース 3</td>
      <td class="center"><%= @user.rubyonrails_status.try(:ga_3) ? '完了' : '未' %></td>
      <td><%= @user.rubyonrails_status.try(:ga_3_compd) %></td>
    </tr>

    <tr>
      <td>学習コース 4</td>
      <td class="center"><%= @user.rubyonrails_status.try(:ga_4) ? '完了' : '未' %></td>
      <td><%= @user.rubyonrails_status.try(:ga_4_compd) %></td>
    </tr>

    <tr>
      <td>学習コース 5</td>
      <td class="center"><%= @user.rubyonrails_status.try(:ga_5) ? '完了' : '未' %></td>
      <td><%= @user.rubyonrails_status.try(:ga_5_compd) %></td>
    </tr>

    <tr>
      <td>学習コース 6</td>
      <td class="center"><%= @user.rubyonrails_status.try(:ga_6) ? '完了' : '未' %></td>
      <td><%= @user.rubyonrails_status.try(:ga_6_compd) %></td>
    </tr>

    <tr>
      <td>学習コース 7</td>
      <td class="center"><%= @user.rubyonrails_status.try(:ga_7) ? '完了' : '未' %></td>
      <td><%= @user.rubyonrails_status.try(:ga_7_compd) %></td>
    </tr>

    <tr>
      <td>学習コース 8</td>
      <td class="center"><%= @user.rubyonrails_status.try(:ga_8) ? '完了' : '未' %></td>
      <td><%= @user.rubyonrails_status.try(:ga_8_compd) %></td>
    </tr>

    <tr>
      <td>学習コース 9</td>
      <td class="center"><%= @user.rubyonrails_status.try(:ga_9) ? '完了' : '未' %></td>
      <td><%= @user.rubyonrails_status.try(:ga_9_compd) %></td>
    </tr>

    <tr>
      <td>学習コース 10</td>
      <td class="center"><%= @user.rubyonrails_status.try(:ga_10) ? '完了' : '未' %></td>
      <td><%= @user.rubyonrails_status.try(:ga_10_compd) %></td>
    </tr>

    <tr>
      <td>学習コース 11</td>
      <td class="center"><%= @user.rubyonrails_status.try(:ga_11) ? '完了' : '未' %></td>
      <td><%= @user.rubyonrails_status.try(:ga_11_compd) %></td>
    </tr>

    <tr>
      <td>道場コース 1</td>
      <td class="center"><%= @user.rubyonrails_status.try(:do_1) ? '完了' : '未' %></td>
      <td><%= @user.rubyonrails_status.try(:do_1_compd) %></td>
    </tr>

    <tr>
      <td>道場コース 2</td>
      <td class="center"><%= @user.rubyonrails_status.try(:do_2) ? '完了' : '未' %></td>
      <td><%= @user.rubyonrails_status.try(:do_2_compd) %></td>
    </tr>

    <tr>
      <td>道場コース 3</td>
      <td class="center"><%= @user.rubyonrails_status.try(:do_3) ? '完了' : '未' %></td>
      <td><%= @user.rubyonrails_status.try(:do_3_compd) %></td>
    </tr>

    <tr>
      <td>道場コース 4</td>
      <td class="center"><%= @user.rubyonrails_status.try(:do_4) ? '完了' : '未' %></td>
      <td><%= @user.rubyonrails_status.try(:do_4_compd) %></td>
    </tr>
  </tbody>
</table>

<table class="txt1 table-condensed table-status-schedule">
   <tr valign="baseline">
    <td width="60%">
      <h3 class="txt3">Rails Tutorial<span class="font-schedule">完了予定日
      <%= @user.railstutorial_status.try(:schedule_date) if @user.railstutorial_status.schedule_date.present? %></span></h3>
    </td>
    <td>
      <%= form_for(@user.railstutorial_status, url: railstutorial_schedule_path ) do |f| %>
      <input style="width:100%" type="date" name="date">
    </td>
    <td width="20%">
      <%= f.submit "登録", class: "btn btn-schedule" %>
      <% end %>
    </td>
  </tr>
</table>
<table class="txt1 table table-bordered table-condensed table-status">
  <tr>
    <td class="table-header">完了した章</td>
    <td class="center"><%= count_rails_tutorial(@user) %>章</td>
  </tr>
</table>

<table class="txt1 table-condensed table-status-schedule">
   <tr valign="baseline">
    <td width="60%">
      <h3 class="txt3">動画視聴<span class="font-schedule">完了予定日
      <%= @user.user_movie_status.try(:schedule_date) if @user.user_movie_status.schedule_date.present? %></span></h3>
    </td>
    <td>
      <%= form_for(@user.user_movie_status, url: user_movie_schedule_path) do |f| %>
      <input style="width:100%" type="date" name="date">
    </td>
    <td width="20%">
      <%= f.submit "登録", class: "btn btn-schedule" %>
      <% end %>
    </td>
  </tr>
</table>

<table class="txt1 table table-bordered table-striped table-condensed table-status">
  <thead>
    <tr>
      <th width=25% class="table-header">動画名</th>
      <th width=15% class="table-header">ステータス</th>
      <th class="table-header">感想</th>
    </tr>
  </thead>
  <% @categories.each do |category| %>
    <% category.movies.order('sort_order').each do |movie| %>
      <% feedback = @user.feedbacks.find_by(movie_id: movie.id) %>
      <tbody>
        <tr>
          <td><%= movie.title %></td>
          <td class="center"><%= feedback.present? ? '完了' : '未' %></td>
          <td><%= feedback.present? ? feedback.feedback : '-' %></td>
        </tr>
      </tbody>
    <% end %>
  <% end %>
</table>

<div class="form-button">
  <% if current_user.admin %>
    <%= link_to 'ユーザ削除', @user, method: :delete, class: 'btn btn-danger user-delete',
        data: { confirm: '本当に削除しますか？' } %>
  <% end %>
  <%= link_to 'ユーザ編集', edit_user_path(@user) , class: 'btn btn-primary user-edit' %>
</div>


<script>
$('.edit-my-picture').click(function(){
  $('#upload-my-picture').show();
  $(this).hide();
});
</script>